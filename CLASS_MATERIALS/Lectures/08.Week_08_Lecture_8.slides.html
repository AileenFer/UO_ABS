<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Peter Ralph">
  <title>Prior distributions and uncertainty</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="reveal.js/css/reveal.css">
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="reveal.js/css/theme/simple.css" id="theme">
  <!-- Printing and PDF exports -->
  <script>
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = window.location.search.match( /print-pdf/gi ) ? 'reveal.js/css/print/pdf.css' : 'reveal.js/css/print/paper.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  </script>
  <!--[if lt IE 9]>
  <script src="reveal.js/lib/js/html5shiv.js"></script>
  <![endif]-->
  <style type="text/css">
  
  .reveal { font-size: 30px; }
  
  .reveal h1 { font-size: 1.5em; } 
  
  .reveal h2 { font-size: 1.2em; } 
  
  .reveal .slides { text-align: left; }
  
  .reveal .slides figure { text-align: center; }
  
  .reveal figcaption { display: none; }
  
  </style>
  \[
  %%
  % Add your macros here; they'll be included in pdf and html output.
  %%
  
  \newcommand{\R}{\mathbb{R}}    % reals
  \newcommand{\E}{\mathbb{E}}    % expectation
  \renewcommand{\P}{\mathbb{P}}  % probability
  \DeclareMathOperator{\logit}{logit}
  \DeclareMathOperator{\logistic}{logistic}
  \DeclareMathOperator{\sd}{sd}
  \DeclareMathOperator{\var}{var}
  \DeclareMathOperator{\cov}{cov}
  \DeclareMathOperator{\Normal}{Normal}
  \DeclareMathOperator{\Poisson}{Poisson}
  \DeclareMathOperator{\Beta}{Beta}
  \DeclareMathOperator{\Binom}{Binomial}
  \DeclareMathOperator{\Gam}{Gamma}
  \DeclareMathOperator{\Exp}{Exponential}
  \DeclareMathOperator{\Cauchy}{Cauchy}
  \DeclareMathOperator{\Unif}{Unif}
  \DeclareMathOperator{\Dirichlet}{Dirichlet}
  \DeclareMathOperator{\Wishart}{Wishart}
  
  \newcommand{\given}{\;\vert\;}
  \]
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide">
  <h1 class="title">Prior distributions and uncertainty</h1>
  <p class="author">Peter Ralph</p>
  <p class="date">13 and 15 November 2018 – Advanced Biological Statistics</p>
</section>

<section><section id="biased-coins" class="title-slide slide level1"><h1>Biased coins</h1></section><section id="a-motivating-example" class="slide level2">
<h2>a motivating example</h2>
<p>Suppose I have two trick coins:</p>
<ul>
<li>one (coin A) comes up heads 75% of the time, and</li>
<li>the other (coin B) only 25% of the time.</li>
</ul>
<div class="fragment">
<p>But, I lost one and I don’t know which! So, I flip it <strong>10 times</strong> and get <strong>6 heads</strong>. <em>Which is it, and how sure are you?</em></p>
</div>
</section><section id="possible-answers" class="slide level2">
<h2>Possible answers:</h2>
<ol type="1">
<li class="fragment"><p>Er, probably coin (A)?</p></li>
<li class="fragment"><p>Well, <span class="math display">\[\begin{aligned}
\P\{ \text{6 H in 10 flips} \given \text{coin A} \}
&amp;= \binom{10}{6} (.75)^6 (.25)^4 \\
&amp;= 0.146
\end{aligned}\]</span> and <span class="math display">\[\begin{aligned}
\P\{ \text{6 H in 10 flips} \given \text{coin B} \}
&amp;= \binom{10}{6} (.25)^6 (.75)^4 \\
&amp;= 0.016
\end{aligned}\]</span> … so, probably coin (A)?</p></li>
</ol>
</section><section class="slide level2">

<p>For a precise answer…</p>
<ol start="3" type="1">
<li><p><em>Before flipping</em>, each coin seems equally likely. Then</p>
<p><span class="math display">\[\begin{aligned}
 \P\{ \text{coin A} \given \text{6 H in 10 flips} \}
 &amp;= \frac{
 \frac{1}{2} \times 0.146
 }{
 \frac{1}{2} \times 0.146
 +
 \frac{1}{2} \times 0.016
 } \\
 &amp;= 0.9
 \end{aligned}\]</span></p></li>
</ol>
</section></section>
<section><section id="probability-review-and-notation" class="title-slide slide level1"><h1>Probability: review and notation</h1></section><section id="probability-rules" class="slide level2">
<h2>Probability rules:</h2>
<ol start="0" type="1">
<li class="fragment"><p><em>Probabilities are proportions:</em> <span class="math inline">\(\hspace{2em} 0 \le \P\{A\} \le 1\)</span></p></li>
<li class="fragment"><p><em>Everything:</em> <span class="math inline">\(\hspace{2em} \P\{ \Omega \} = 1\)</span></p></li>
<li class="fragment"><p><em>Complements:</em> <span class="math inline">\(\hspace{2em} \P\{ \text{not } A\} = 1 - \P\{A\}\)</span></p></li>
<li class="fragment"><p><em>Disjoint events:</em> If <span class="math inline">\(\hspace{2em} \P\{A \text{ and } B\} = 0\)</span> then <span class="math inline">\(\hspace{2em} \P\{A \text{ or } B\} = \P\{A\} + \P\{B\}\)</span>.</p></li>
<li class="fragment"><p><em>Independence:</em> <span class="math inline">\(A\)</span> and <span class="math inline">\(B\)</span> are independent iff <span class="math inline">\(\P\{A \text{ and } B\} = \P\{A\} \P\{B\}\)</span>.</p></li>
<li class="fragment"><p><em>Conditional probability:</em> <span class="math display">\[\P\{A \given B\} = \frac{\P\{A \text{ and } B\}}{ \P\{B\} }\]</span></p></li>
</ol>
</section><section id="bayes-rule" class="slide level2">
<h2>Bayes’ rule</h2>
<p>A consequence is</p>
<p><span class="math display">\[\P\{B \given A\} = \frac{\P\{B\} \P\{A \given B\}}{ \P\{A\} } .\]</span></p>
<div class="fragment">
<p>In “Bayesian statistics”:</p>
<ul>
<li class="fragment"><span class="math inline">\(B\)</span>: possible model</li>
<li class="fragment"><span class="math inline">\(A\)</span>: data</li>
<li class="fragment"><span class="math inline">\(\P\{B\}\)</span>: prior weight on model <span class="math inline">\(B\)</span></li>
<li class="fragment"><span class="math inline">\(\P\{A \given B\}\)</span>: likelihood of data under <span class="math inline">\(B\)</span></li>
<li class="fragment"><span class="math inline">\(\P\{B\} \P\{A \given B\}\)</span>: posterior weight on <span class="math inline">\(B\)</span></li>
<li class="fragment"><span class="math inline">\(\P\{A\}\)</span>: total sum of posterior weights</li>
</ul>
</div>
</section></section>
<section><section id="breaking-it-down-with-more-coins" class="title-slide slide level1"><h1>Breaking it down with more coins</h1></section><section id="section" class="slide level2">
<h2></h2>
<p>Suppose instead I had 9 coins, with probabilities 10%, 20%, …, 90%; as before I flipped one 10 times and got 6 heads. For each <span class="math inline">\(\theta\)</span> in <span class="math inline">\(0.1, 0.2, \ldots, 0.8, 0.9,\)</span> find <span class="math display">\[\begin{aligned}
    \P\{\text{ coin has prob $\theta$ } \given \text{ 6 H in 10 flips } \} .
\end{aligned}\]</span></p>
<p><em>Question:</em> which coin(s) is it, and how sure are we? (And, what does it mean when we say how sure we are?)</p>
</section><section id="uniform-prior" class="slide level2">
<h2>Uniform prior</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/the_prior-1.png" title="plot of chunk the_prior" alt="plot of chunk the_prior" style="display: block; margin: auto;" /></p>
</div>
</div>
</section><section id="weak-prior" class="slide level2">
<h2>Weak prior</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/weak_prior-1.png" title="plot of chunk weak_prior" alt="plot of chunk weak_prior" style="display: block; margin: auto;" /></p>
</div>
</div>
</section><section id="strong-prior" class="slide level2">
<h2>Strong prior</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/strong_prior-1.png" title="plot of chunk strong_prior" alt="plot of chunk strong_prior" style="display: block; margin: auto;" /></p>
</div>
</div>
</section><section id="the-likelihood-6-h-in-10-flips" class="slide level2">
<h2>The likelihood: 6 H in 10 flips</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/ten_flips-1.png" title="plot of chunk ten_flips" alt="plot of chunk ten_flips" style="display: block; margin: auto;" /></p>
</div>
</div>
</section><section id="the-likelihood-30-h-in-50-flips" class="slide level2">
<h2>The likelihood: 30 H in 50 flips</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/fifty_flips-1.png" title="plot of chunk fifty_flips" alt="plot of chunk fifty_flips" style="display: block; margin: auto;" /></p>
</div>
</div>
</section><section id="the-likelihood-60-h-in-100-flips" class="slide level2">
<h2>The likelihood: 60 H in 100 flips</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/100_flips-1.png" title="plot of chunk 100_flips" alt="plot of chunk 100_flips" style="display: block; margin: auto;" /></p>
</div>
</div>
</section><section id="the-likelihood-6000-h-in-10000-flips" class="slide level2">
<h2>The likelihood: 6,000 H in 10,000 flips</h2>
<div class="columns">
<div class="column" style="width:20%;">
<p>prior</p>
<p><span class="math inline">\(\times\)</span></p>
<p>likelihood</p>
<p><span class="math inline">\(\propto\)</span></p>
<p>posterior</p>
</div><div class="column" style="width:80%;">
<p><img src="figure/08.Week_08_Lecture_8/ten_thou_flips-1.png" title="plot of chunk ten_thou_flips" alt="plot of chunk ten_thou_flips" style="display: block; margin: auto;" /></p>
</div>
</div>
</section></section>
<section><section id="a-question" class="title-slide slide level1"><h1>A question</h1></section><section id="what-is-the-right-answer-to-the-coin-question" class="slide level2">
<h2>What is the right answer to the “coin question”?</h2>
<div class="columns">
<div class="column" style="width:60%;">
<p>Recall: there were nine possible values of <span class="math inline">\(\theta\)</span>.</p>
<p>Which coin is it, and how sure are you?</p>
<p><em>Possible types of answer:</em></p>
<ol type="1">
<li>“best guess”</li>
<li>“range of values”</li>
<li>“don’t know”</li>
</ol>
<p>Give examples of when each type of answer is the right one.</p>
</div><div class="column" style="width:40%;">
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">theta &lt;-<span class="st"> </span>(<span class="dv">1</span><span class="op">:</span><span class="dv">9</span>)<span class="op">/</span><span class="dv">10</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2">prior &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span><span class="op">/</span><span class="dv">9</span>, <span class="dv">9</span>)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3">likelihood &lt;-<span class="st"> </span><span class="kw">dbinom</span>(<span class="dv">6</span>, <span class="dt">size=</span><span class="dv">10</span>, <span class="dt">prob=</span>theta)</a>
<a class="sourceLine" id="cb1-4" data-line-number="4">posterior &lt;-<span class="st"> </span>prior<span class="op">*</span>likelihood<span class="op">/</span><span class="kw">sum</span>(prior<span class="op">*</span>likelihood)</a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw">names</span>(posterior) &lt;-<span class="st"> </span>theta</a>
<a class="sourceLine" id="cb1-6" data-line-number="6"><span class="kw">barplot</span>(posterior, <span class="dt">xlab=</span><span class="st">&#39;true prob of heads&#39;</span>, <span class="dt">main=</span><span class="st">&#39;posterior probability&#39;</span>)</a></code></pre></div>
<p><img src="figure/08.Week_08_Lecture_8/plot_pos-1.png" title="plot of chunk plot_pos" alt="plot of chunk plot_pos" style="display: block; margin: auto;" /></p>
</div>
</div>
</section></section>
<section><section id="stochastic-minute" class="title-slide slide level1"><h1>Stochastic Minute</h1></section><section id="the-beta-distribution" class="slide level2">
<h2>The Beta Distribution</h2>
<p>If <span class="math display">\[P \sim \text{Beta}(a,b)\]</span> then <span class="math inline">\(P\)</span> has <em>probability density</em> <span class="math display">\[p(\theta) = \frac{ \theta^{a-1} (1 - \theta)^{b-1} }{ B(a,b) } . \]</span></p>
<ul>
<li><p>Takes values between 0 and 1.</p></li>
<li><p>If <span class="math inline">\(U_{(1)} &lt; U_{(2)} &lt; \cdots &lt; U_{(n)}\)</span> are sorted, independent <span class="math inline">\(\text{Unif}[0,1]\)</span> then <span class="math inline">\(U_{(k)} \sim \text{Beta}(k, n-k+1)\)</span>.</p></li>
<li><p>Mean: <span class="math inline">\(a/(a+b)\)</span>.</p></li>
<li><p>Larger <span class="math inline">\(a+b\)</span> is more tightly concentrated (like <span class="math inline">\(1/\sqrt{a+b}\)</span>)</p></li>
</ul>
</section><section id="exercise" class="slide level2">
<h2>Exercise</h2>
<p>In pairs, <em>simulate</em>:</p>
<ol type="1">
<li><p>One thousand “random coins” whose probabilities are drawn from a <span class="math inline">\(\Beta(5,5)\)</span> distribution. (<code>rbeta()</code>) Make a histogram of these probabilities.</p></li>
<li><p>Flip each coin ten times and record the number of heads. (<code>rbinom()</code>)</p></li>
<li><p>Make a histogram of the <em>probabilities</em> of those coins that got exactly 3 heads, and compare to the first histogram.</p></li>
</ol>
</section></section>
<section><section id="unknown-coins" class="title-slide slide level1"><h1>Unknown coins</h1></section><section id="motivating-example" class="slide level2">
<h2>Motivating example</h2>
<p>Now suppose we want to estimate the probability of heads for a coin <em>without</em> knowing the possible values. (or, a disease incidence, or error rate in an experiment, …)</p>
<p>We flip it <span class="math inline">\(n\)</span> times and get <span class="math inline">\(Z\)</span> Heads.</p>
<p>The <em>likelihood</em> of this, given the prob-of-heads <span class="math inline">\(\theta\)</span>, is: <span class="math display">\[p(z \given \theta) = \binom{n}{z}\theta^z (1-\theta)^{n-z} . \]</span></p>
<p>How to weight the possible <span class="math inline">\(\theta\)</span>? Need a flexible set of weighting functions, i.e., <strong>prior distributions</strong> on <span class="math inline">\([0,1]\)</span>.</p>
<div class="fragment">
<ul>
<li><strong>Beta</strong> distributions.</li>
</ul>
</div>
</section><section class="slide level2">

<p>What would we use if:</p>
<ul>
<li><p>the coin is probably close to fair.</p></li>
<li><p>the disease is probably quite rare.</p></li>
<li><p>no idea whatsoever.</p></li>
</ul>
</section><section id="beta-binomial-bayesian-analysis" class="slide level2">
<h2>Beta-Binomial Bayesian analysis</h2>
<p>If <span class="math display">\[\begin{aligned}
P &amp;\sim \text{Beta}(a,b) \\
Z &amp;\sim \text{Binom}(n,P) ,
\end{aligned}\]</span> then by Bayes’ rule: <span class="math display">\[\begin{aligned}
 \P\{ P = \theta \given Z = z\}
 &amp;=
 \frac{\P\{Z = z \given P = \theta \} \P\{P = \theta\}}{\P\{Z = z\}} \\
 &amp;= 
 \frac{
 \binom{n}{z}\theta^z (1-\theta)^{n-z}
 \times
 \frac{\theta^{a-1}(1-\theta)^{b-1}}{B(a,b)}
 }{
 \text{(something)}
 } \\
 &amp;=
 \text{(something else)} \times \theta^{a + z - 1} (1-\theta)^{b + n - z - 1} .
\end{aligned}\]</span></p>
<div class="fragment">
<p>“Miraculously” <em>(the Beta is the conjugate prior for the Binomial)</em>, <span class="math display">\[\begin{aligned}
P \given Z = z \sim \text{Beta}(a+z, b+n-z) .
\end{aligned}\]</span></p>
</div>
</section><section id="discussdemonstration" class="slide level2">
<h2>Discuss/demonstration:</h2>
<p>We flip an odd-looking coin 100 times, and get 65 heads. What is it’s true* probability of heads?</p>
<ol type="1">
<li><p>True = ??</p></li>
<li><p>What prior to use?</p></li>
<li><p>Is it reasonable that <span class="math inline">\(\theta = 1/2\)</span>?</p></li>
<li><p>Best guess at <span class="math inline">\(\theta\)</span>?</p></li>
<li><p>How far off are we, probably?</p></li>
</ol>
</section></section>
<section><section id="reporting-uncertainty" class="title-slide slide level1"><h1>Reporting uncertainty</h1></section><section id="how-do-we-communicate-results" class="slide level2">
<h2>How do we communicate results?</h2>
<p>If we want a <em>point estimate</em>:</p>
<ol type="1">
<li>posterior mean,</li>
<li>posterior median, or</li>
<li>maximum <em>a posteriori</em> estimate (“MAP”: highest posterior density).</li>
</ol>
<p>These all convey “where the posterior distribution is”, more or less.</p>
<div class="fragment">
<p>What about uncertainty?</p>
</div>
</section><section id="credible-region" class="slide level2">
<h2>Credible region</h2>
<p><strong>Definition:</strong> A 95% <em>credible region</em> is a portion of parameter space having a total of 95% of the <em>posterior probability</em>.</p>
<div class="fragment">
<p>(same with other numbers for “95%”)</p>
</div>
</section><section id="interpretation-1" class="slide level2">
<h2>Interpretation #1</h2>
<p>If we construct a 95% credible interval for <span class="math inline">\(\theta\)</span> for each of many datasets; <em>and</em> the coin in each dataset has <span class="math inline">\(\theta\)</span> drawn independently from the prior, <em>then</em> the true <span class="math inline">\(\theta\)</span> will fall in its credible interval for 95% of the datasets.</p>
</section><section id="interpretation-2" class="slide level2">
<h2>Interpretation #2</h2>
<p>If we construct a 95% credible interval for <span class="math inline">\(\theta\)</span> with a dataset, and the distribution of the coin’s true <span class="math inline">\(\theta\)</span> across many parallel universes is given by the prior, then the true <span class="math inline">\(\theta\)</span> will be in the credible interval in 95% of those universes.</p>
</section><section id="interpretation-3" class="slide level2">
<h2>Interpretation #3</h2>
<p>Given my prior beliefs (prior distribution), the posterior distribution is the most rational<span class="math inline">\({}^*\)</span> way to update my beliefs to account for the data.</p>
<div class="fragment">
<p><span class="math inline">\({}^*\)</span> if you do this many times you will be wrong least often</p>
</div>
<div class="fragment">
<p><span class="math inline">\({}^*\)</span> <strong>or</strong> you will be wrong in the fewest possible universes</p>
</div>
</section><section id="but-which-credible-interval" class="slide level2">
<h2>But which credible interval?</h2>
<p><strong>Definition:</strong> The “95% highest density interval” is the 95% credible interval with the highest posterior probability density at each point.</p>
<div class="fragment">
<p>((back to the simple example))</p>
</div>
</section></section>
<section><section id="hierarchical-coins" class="title-slide slide level1"><h1>Hierarchical coins</h1></section><section id="motivating-problem-more-coins" class="slide level2">
<h2>Motivating problem: more coins</h2>
<p>Suppose now we have data from <span class="math inline">\(n\)</span> different coins from the same source. We don’t assume they have the <em>same</em> <span class="math inline">\(\theta\)</span>, but don’t know what it’s distribution is, so try to <em>learn</em> it.</p>
<p><span class="math display">\[\begin{aligned}
    Z_i &amp;\sim \Binom(N_i, \theta_i) \\
    \theta_i &amp;\sim \Beta(\text{mode}=\omega, \text{conc}=\kappa) \\
    \omega &amp; = ? \\
    \kappa &amp; = ? 
\end{aligned}\]</span></p>
<p><em>note:</em> The “mode” and “concentration” are related to the shape parameters by: <span class="math inline">\(\alpha = \omega (\kappa - 2) + 1\)</span> and <span class="math inline">\(\beta = (1 - \omega) (\kappa - 2) + 1\)</span>.</p>
</section><section id="binomial-versus-beta-binomial" class="slide level2">
<h2>Binomial versus Beta-Binomial</h2>
<p>What is different between:</p>
<ol type="1">
<li><p>Pick a value of <span class="math inline">\(\theta\)</span> at random from <span class="math inline">\(\Beta(3,1)\)</span>. Flip one thousand <span class="math inline">\(\theta\)</span>-coins, 500 times each.</p></li>
<li><p>Pick one thousand random <span class="math inline">\(\theta_i \sim \Beta(3,1)\)</span> values. Flip one thousand coins, one for each <span class="math inline">\(\theta_i\)</span>, 500 times each.</p></li>
</ol>
</section><section class="slide level2">

<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1">ncoins &lt;-<span class="st"> </span><span class="dv">1000</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">nflips &lt;-<span class="st"> </span><span class="dv">100</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">theta1 &lt;-<span class="st"> </span><span class="kw">rbeta</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">binom_Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(ncoins, <span class="dt">size=</span>nflips, <span class="dt">prob=</span>theta1)</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">theta2 &lt;-<span class="st"> </span><span class="kw">rbeta</span>(ncoins,<span class="dv">3</span>,<span class="dv">1</span>)</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">bb_Z &lt;-<span class="st"> </span><span class="kw">rbinom</span>(ncoins, <span class="dt">size=</span>nflips, <span class="dt">prob=</span>theta2)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7"><span class="kw">hist</span>(binom_Z, <span class="dt">breaks=</span><span class="dv">30</span>, <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;blue&quot;</span>, <span class="fl">0.5</span>), <span class="dt">main=</span><span class="st">&#39;&#39;</span>, <span class="dt">xlim=</span><span class="kw">c</span>(<span class="dv">0</span>,nflips), <span class="dt">freq=</span><span class="ot">FALSE</span>, <span class="dt">xlab=</span><span class="st">&#39;number of Heads&#39;</span>)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"><span class="kw">hist</span>(bb_Z, <span class="dt">breaks=</span><span class="dv">30</span>, <span class="dt">col=</span><span class="kw">adjustcolor</span>(<span class="st">&quot;red&quot;</span>, <span class="fl">0.5</span>), <span class="dt">add=</span><span class="ot">TRUE</span>, <span class="dt">freq=</span><span class="ot">FALSE</span>)</a></code></pre></div>
<p><img src="figure/08.Week_08_Lecture_8/beta_or_binom-1.png" title="plot of chunk beta_or_binom" alt="plot of chunk beta_or_binom" style="display: block; margin: auto;" /></p>
</section></section>
<section><section id="mc-stan" class="title-slide slide level1"><h1>MC Stan</h1></section><section id="stan" class="slide level2">
<h2>Stan</h2>
<figure>
<img data-src="stan.jpeg" alt="Stanislaw Ulam" style="height:10em" /><figcaption>Stanislaw Ulam</figcaption>
</figure>
</section><section id="the-skeletal-stan-program" class="slide level2">
<h2>The skeletal Stan program</h2>
<pre><code>data {
    // stuff you input
}
transformed data {
    // stuff that&#39;s calculated from the data (just once, at the start)
}
parameters {
    // stuff you want to learn about
}
transformed parameters {
    // stuff that&#39;s calculated from the parameters (at every step)
}
model {
    // the action!
}
generated quantities {
    // stuff you want computed also along the way
}</code></pre>
</section></section>
<section><section id="beta-binomial-with-stan" class="title-slide slide level1"><h1>Beta-Binomial with Stan</h1></section><section id="first-in-words" class="slide level2">
<h2>First, in words:</h2>
<p>We’ve flipped a coin 10 times and got 6 Heads. We think the coin is close to fair, so put a <span class="math inline">\(\Beta(20,20)\)</span> prior on it’s probability of heads, and want the posterior distribution.</p>
<p><span class="math display">\[\begin{aligned}
    Z &amp;\sim \Binom(10, \theta) \\
    \theta &amp;\sim \Beta(20, 20) 
\end{aligned}\]</span> What’s our <em>best guess</em> at <span class="math inline">\(\theta\)</span>?</p>
</section><section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[\begin{aligned}
    Z &amp;\sim \Binom(10, \theta) \\
    \theta &amp;\sim \Beta(20, 20) 
\end{aligned}\]</span></p>
<p>What’s our <em>best guess</em> at <span class="math inline">\(\theta\)</span>?</p>
</div><div class="column" style="width:50%;">
<pre><code>data {
    // stuff you input
}
parameters {
    // stuff you want to learn 
    // the posterior distribution of
}
model {
    // the action!
}</code></pre>
</div>
</div>
</section><section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[\begin{aligned}
    Z &amp;\sim \Binom(10, \theta) \\
    \theta &amp;\sim \Beta(20, 20) 
\end{aligned}\]</span></p>
<p>Sample from <span class="math display">\[\theta \given Z = 6\]</span></p>
</div><div class="column" style="width:50%;">
<pre><code>data {
    int N;   // number of flips
    int Z;   // number of heads
}
parameters {
    // stuff you want to learn 
    // the posterior distribution of
}
model {
    // the action!
}</code></pre>
</div>
</div>
</section><section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[\begin{aligned}
    Z &amp;\sim \Binom(10, \theta) \\
    \theta &amp;\sim \Beta(20, 20) 
\end{aligned}\]</span></p>
<p>Sample from <span class="math display">\[\theta \given Z = 6\]</span></p>
</div><div class="column" style="width:50%;">
<pre><code>data {
    int N;   // number of flips
    int Z;   // number of heads
}
parameters {
    // probability of heads
    real&lt;lower=0,upper=1&gt; theta;  
}
model {
    // the action!
}</code></pre>
</div>
</div>
</section><section class="slide level2">

<div class="columns">
<div class="column" style="width:50%;">
<p><span class="math display">\[\begin{aligned}
    Z &amp;\sim \Binom(10, \theta) \\
    \theta &amp;\sim \Beta(20, 20) 
\end{aligned}\]</span></p>
<p>Sample from <span class="math display">\[\theta \given Z = 6\]</span></p>
</div><div class="column" style="width:50%;">
<pre><code>data {
    int N;   // number of flips
    int Z;   // number of heads
}
parameters {
    // probability of heads
    real&lt;lower=0,upper=1&gt; theta;
}
model {
    Z ~ binomial(N, theta);
    theta ~ beta(20, 20);
}</code></pre>
</div>
</div>
</section><section id="the-stan-model" class="slide level2">
<h2>The Stan model</h2>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="kw">library</span>(rstan)</a>
<a class="sourceLine" id="cb8-2" data-line-number="2">stan_block &lt;-<span class="st"> &quot;</span></a>
<a class="sourceLine" id="cb8-3" data-line-number="3"><span class="st">data {</span></a>
<a class="sourceLine" id="cb8-4" data-line-number="4"><span class="st">    int N;   // number of flips</span></a>
<a class="sourceLine" id="cb8-5" data-line-number="5"><span class="st">    int Z;   // number of heads</span></a>
<a class="sourceLine" id="cb8-6" data-line-number="6"><span class="st">}</span></a>
<a class="sourceLine" id="cb8-7" data-line-number="7"><span class="st">parameters {</span></a>
<a class="sourceLine" id="cb8-8" data-line-number="8"><span class="st">    // probability of heads</span></a>
<a class="sourceLine" id="cb8-9" data-line-number="9"><span class="st">    real&lt;lower=0,upper=1&gt; theta;</span></a>
<a class="sourceLine" id="cb8-10" data-line-number="10"><span class="st">}</span></a>
<a class="sourceLine" id="cb8-11" data-line-number="11"><span class="st">model {</span></a>
<a class="sourceLine" id="cb8-12" data-line-number="12"><span class="st">    Z ~ binomial(N, theta);</span></a>
<a class="sourceLine" id="cb8-13" data-line-number="13"><span class="st">    theta ~ beta(20, 20);</span></a>
<a class="sourceLine" id="cb8-14" data-line-number="14"><span class="st">}</span></a>
<a class="sourceLine" id="cb8-15" data-line-number="15"><span class="st">&quot;</span></a>
<a class="sourceLine" id="cb8-16" data-line-number="16">bb_model &lt;-<span class="st"> </span><span class="kw">stan_model</span>(</a>
<a class="sourceLine" id="cb8-17" data-line-number="17">               <span class="dt">model_code=</span>stan_block)</a></code></pre></div>
</section><section id="optimization-maximum-likelihood" class="slide level2">
<h2>Optimization: maximum likelihood</h2>
<p>With a uniform prior, the “maximum posterior” parameter values are also the <em>maximum likelihood</em> values.</p>
<div class="fragment">
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="op">&gt;</span><span class="st"> </span><span class="kw">help</span>(optimizing)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2"></a>
<a class="sourceLine" id="cb9-3" data-line-number="3">optimizing                package<span class="op">:</span>rstan                R Documentation</a>
<a class="sourceLine" id="cb9-4" data-line-number="4"></a>
<a class="sourceLine" id="cb9-5" data-line-number="5">Obtain a point estimate by maximizing the joint posterior</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">Description<span class="op">:</span></a>
<a class="sourceLine" id="cb9-8" data-line-number="8"></a>
<a class="sourceLine" id="cb9-9" data-line-number="9"><span class="st">     </span>Obtain a point estimate by maximizing the joint posterior from the</a>
<a class="sourceLine" id="cb9-10" data-line-number="10">     model defined by class <span class="st">&#39;stanmodel&#39;</span>.</a>
<a class="sourceLine" id="cb9-11" data-line-number="11"></a>
<a class="sourceLine" id="cb9-12" data-line-number="12">Usage<span class="op">:</span></a>
<a class="sourceLine" id="cb9-13" data-line-number="13"></a>
<a class="sourceLine" id="cb9-14" data-line-number="14"><span class="st">     </span>## S4 method for signature &#39;stanmodel&#39;</a>
<a class="sourceLine" id="cb9-15" data-line-number="15"><span class="st">     </span><span class="kw">optimizing</span>(object, <span class="dt">data =</span> <span class="kw">list</span>(),</a></code></pre></div>
</div>
</section><section id="maximum-posterior" class="slide level2">
<h2>Maximum posterior</h2>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1"><span class="kw">library</span>(rstan)</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">(fit &lt;-<span class="st"> </span><span class="kw">optimizing</span>(bb_model,  <span class="co"># stan model from above</span></a>
<a class="sourceLine" id="cb10-3" data-line-number="3">                   <span class="dt">data=</span><span class="kw">list</span>(<span class="dt">N=</span><span class="dv">10</span>, <span class="dt">Z=</span><span class="dv">6</span>)))</a></code></pre></div>
<pre><code>## Initial log joint probability = -42.3369
## Optimization terminated normally: 
##   Convergence detected: relative gradient magnitude is below tolerance</code></pre>
<pre><code>## $par
##     theta 
## 0.5208333 
## 
## $value
## [1] -33.22939
## 
## $return_code
## [1] 0</code></pre>
</section><section id="lets-check-that" class="slide level2">
<h2>Let’s check that</h2>
<div class="columns">
<div class="column" style="width:50%;">
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">post_fun &lt;-<span class="st"> </span><span class="cf">function</span> (p) {</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">    n &lt;-<span class="st"> </span><span class="dv">10</span>; z &lt;-<span class="st"> </span><span class="dv">6</span>; a &lt;-<span class="st"> </span>b &lt;-<span class="st"> </span><span class="dv">20</span></a>
<a class="sourceLine" id="cb13-3" data-line-number="3">    lik &lt;-<span class="st"> </span><span class="kw">dbinom</span>(z, <span class="dt">size=</span>n, <span class="dt">prob=</span>p)</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">    prior &lt;-<span class="st"> </span><span class="kw">dbeta</span>(p, a, b)</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">    <span class="kw">return</span>( prior <span class="op">*</span><span class="st"> </span>lik )</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">}</a>
<a class="sourceLine" id="cb13-7" data-line-number="7"><span class="kw">curve</span>(post_fun, <span class="dv">0</span>, <span class="dv">1</span>, <span class="dt">xlab=</span><span class="kw">expression</span>(theta), <span class="dt">ylab=</span><span class="st">&#39;posterior prob&#39;</span>)</a>
<a class="sourceLine" id="cb13-8" data-line-number="8"><span class="kw">points</span>(fit<span class="op">$</span>par, <span class="kw">post_fun</span>(fit<span class="op">$</span>par), <span class="dt">col=</span><span class="st">&#39;red&#39;</span>, <span class="dt">pch=</span><span class="dv">20</span>)</a></code></pre></div>
</div><div class="column" style="width:50%;">
<p><img src="figure/08.Week_08_Lecture_8/stan_check-1.png" title="plot of chunk stan_check" alt="plot of chunk stan_check" style="display: block; margin: auto;" /></p>
</div>
</div>
</section></section>
<section><section id="wrap-up" class="title-slide slide level1"><h1>Wrap-up</h1></section><section id="section-1" class="slide level2">
<h2></h2>
<p>posterior <span class="math inline">\(=\)</span> prior <span class="math inline">\(\times\)</span> likelihood</p>
<div class="fragment">
<p>“updating prior ideas based on (more) data”</p>
</div>
<div class="fragment">
<p>Stan lets us find <em>best fitting</em> parameters for <em>models</em>.</p>
</div>
<div class="fragment">
<p>Next time: <strong>uncertainty</strong>.</p>
</div>
</section></section>
<section><section id="appendix" class="title-slide slide level1"><h1>Appendix</h1></section><section id="exercise-check-the-beta-binomial" class="slide level2">
<h2>Exercise: check the Beta-Binomial</h2>
<ol type="1">
<li><p>Simulate <span class="math inline">\(10^6\)</span> coin <em>probabilities</em>, called <span class="math inline">\(\theta\)</span>, from Beta(5,5). (<code>rbeta</code>)</p></li>
<li><p>For <em>each coin</em>, simulate 10 flips. (<code>rbinom</code>)</p></li>
<li><p>Make a histogram of the true probabilities (values of <span class="math inline">\(\theta\)</span>) of <em>only</em> those coins having 3 of 10 heads.</p></li>
<li><p>Compare the distribution to Beta(<span class="math inline">\(a\)</span>,<span class="math inline">\(b\)</span>) – with what <span class="math inline">\(a\)</span> and <span class="math inline">\(b\)</span>? (<code>dbeta</code>)</p></li>
<li><p>Explain what happened.</p></li>
</ol>
</section></section>
    </div>
  </div>

  <script src="reveal.js/lib/js/head.min.js"></script>
  <script src="reveal.js/js/reveal.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        // Display the page number of the current slide
        slideNumber: true,
        // Push each slide change to the browser history
        history: true,
        // Transition style
        transition: 'none', // none/fade/slide/convex/concave/zoom
        math: {
          mathjax: '/usr/share/javascript/mathjax/MathJax.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // Optional reveal.js plugins
        dependencies: [
          { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true },
          { src: 'reveal.js/plugin/math/math.js', async: true },
          { src: 'reveal.js/plugin/notes/notes.js', async: true }
        ]
      });
    </script>
    </body>
</html>
